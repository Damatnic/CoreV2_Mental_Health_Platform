/**
 * ACCESSIBILITY VALIDATION SYSTEM
 * Ensures WCAG 2.1 AA compliance across all components
 * Mental health platforms require exceptional accessibility
 */

@import "./unified-design-system.css";

/* ========================================
   FOCUS MANAGEMENT SYSTEM
   ======================================== */

/* Universal focus indicator */
*:focus-visible {
  outline: var(--focus-ring-width) solid var(--focus-ring-color);
  outline-offset: var(--focus-ring-offset);
  border-radius: var(--radius-sm);
}

/* High contrast focus for crisis elements */
.crisis-element:focus-visible,
.btn-crisis:focus-visible,
.alert-crisis:focus-visible {
  outline-width: 3px;
  outline-color: var(--color-crisis-urgent);
  outline-offset: 3px;
}

/* Skip to content link */
.skip-to-content {
  position: absolute;
  top: -100px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--color-primary-600);
  color: white;
  padding: var(--space-3) var(--space-6);
  border-radius: var(--radius-lg);
  text-decoration: none;
  font-weight: var(--font-semibold);
  z-index: var(--z-tooltip);
  transition: top var(--duration-fast) var(--ease-out);
}

.skip-to-content:focus {
  top: var(--space-4);
}

/* Focus trap for modals */
.focus-trap {
  position: relative;
}

.focus-trap:focus {
  outline: none;
}

/* ========================================
   COLOR CONTRAST VALIDATION
   ======================================== */

/* Text contrast requirements - WCAG AA */
.text-contrast-normal {
  /* 4.5:1 minimum for normal text */
  color: var(--color-neutral-700);
  background: white;
}

.text-contrast-large {
  /* 3:1 minimum for large text (18px+) */
  font-size: var(--text-md);
  color: var(--color-neutral-600);
  background: white;
}

/* Ensure link contrast */
a {
  color: var(--color-primary-600);
  text-decoration: underline;
  text-decoration-thickness: 1px;
  text-underline-offset: 2px;
}

a:visited {
  color: var(--color-primary-700);
}

a:hover {
  text-decoration-thickness: 2px;
}

/* Error text must be distinguishable */
.error-text {
  color: var(--color-error-dark);
  font-weight: var(--font-medium);
}

.error-text::before {
  content: "⚠ ";
  font-size: 1.2em;
}

/* ========================================
   TOUCH TARGET REQUIREMENTS
   ======================================== */

/* Minimum touch target size (44x44px) */
button,
a,
input[type="checkbox"],
input[type="radio"],
select,
[role="button"],
[role="link"] {
  min-height: var(--touch-target-min);
  min-width: var(--touch-target-min);
}

/* Inline links need padding for touch */
p a,
li a,
span a {
  padding: var(--space-1) var(--space-2);
  margin: calc(var(--space-1) * -1) calc(var(--space-2) * -1);
}

/* Touch target spacing */
.touch-target-group > * + * {
  margin-top: var(--space-2);
}

/* ========================================
   SCREEN READER SUPPORT
   ======================================== */

/* Visually hidden but screen reader accessible */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Screen reader only focus */
.sr-only-focusable:focus {
  position: static;
  width: auto;
  height: auto;
  padding: inherit;
  margin: inherit;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

/* Live regions for dynamic content */
.aria-live-polite {
  position: relative;
}

[aria-live="polite"] {
  position: relative;
}

[aria-live="assertive"] {
  position: relative;
  font-weight: var(--font-semibold);
}

/* Loading states for screen readers */
[aria-busy="true"] {
  position: relative;
}

[aria-busy="true"]::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ========================================
   FORM ACCESSIBILITY
   ======================================== */

/* Required field indicators */
.required-field::after {
  content: " (required)";
  color: var(--color-error);
  font-size: var(--text-sm);
  font-weight: var(--font-regular);
}

/* Error messages association */
.field-error {
  color: var(--color-error-dark);
  font-size: var(--text-sm);
  margin-top: var(--space-1);
  display: flex;
  align-items: center;
  gap: var(--space-1);
}

.field-error::before {
  content: "✕";
  display: inline-block;
  width: var(--space-4);
  height: var(--space-4);
  background: var(--color-error);
  color: white;
  border-radius: var(--radius-full);
  text-align: center;
  line-height: var(--space-4);
  flex-shrink: 0;
}

/* Success messages */
.field-success {
  color: var(--color-success-dark);
  font-size: var(--text-sm);
  margin-top: var(--space-1);
  display: flex;
  align-items: center;
  gap: var(--space-1);
}

.field-success::before {
  content: "✓";
  display: inline-block;
  width: var(--space-4);
  height: var(--space-4);
  background: var(--color-success);
  color: white;
  border-radius: var(--radius-full);
  text-align: center;
  line-height: var(--space-4);
  flex-shrink: 0;
}

/* Fieldset and legend styling */
fieldset {
  border: 2px solid var(--color-neutral-300);
  border-radius: var(--radius-lg);
  padding: var(--space-4);
  margin-bottom: var(--space-6);
}

legend {
  padding: 0 var(--space-2);
  font-weight: var(--font-semibold);
  color: var(--color-neutral-700);
}

/* ========================================
   KEYBOARD NAVIGATION
   ======================================== */

/* Tab order indicators */
[tabindex="0"] {
  position: relative;
}

[tabindex="-1"] {
  outline: none;
}

/* Keyboard shortcuts help */
.kbd {
  display: inline-block;
  padding: var(--space-1) var(--space-2);
  font-size: var(--text-sm);
  font-family: var(--font-mono);
  background: var(--color-neutral-100);
  border: 1px solid var(--color-neutral-300);
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-xs);
}

/* ========================================
   HIGH CONTRAST MODE
   ======================================== */

@media (prefers-contrast: high) {
  * {
    border-color: currentColor !important;
  }
  
  button,
  .btn {
    border: 2px solid currentColor !important;
  }
  
  .card {
    border: 2px solid currentColor !important;
    background: transparent !important;
  }
  
  input,
  select,
  textarea {
    border: 2px solid currentColor !important;
  }
  
  *:focus-visible {
    outline-width: 3px !important;
    outline-color: currentColor !important;
  }
}

/* ========================================
   REDUCED MOTION
   ======================================== */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  .animate-pulse,
  .subtle-pulse {
    animation: none !important;
  }
}

/* ========================================
   DARK MODE ACCESSIBILITY
   ======================================== */

[data-theme="dark"] {
  /* Ensure sufficient contrast in dark mode */
  --focus-ring-color: var(--color-primary-400);
  
  /* Adjust link colors for dark backgrounds */
  a {
    color: var(--color-primary-400);
  }
  
  a:visited {
    color: var(--color-primary-300);
  }
  
  /* Error text in dark mode */
  .error-text,
  .field-error {
    color: #fca5a5;
  }
  
  /* Success text in dark mode */
  .field-success {
    color: #86efac;
  }
}

/* ========================================
   CRISIS MODE ACCESSIBILITY
   ======================================== */

.crisis-mode {
  /* Larger text for crisis situations */
  font-size: calc(var(--text-base) * 1.125);
  
  /* Higher contrast */
  --color-neutral-900: #000000;
  --color-neutral-50: #ffffff;
  
  /* Larger touch targets */
  --touch-target-min: 48px;
}

.crisis-mode button,
.crisis-mode a,
.crisis-mode input {
  min-height: 48px;
  font-size: var(--text-md);
  font-weight: var(--font-semibold);
}

/* Crisis hotline always visible */
.crisis-hotline {
  position: fixed;
  bottom: var(--space-4);
  right: var(--space-4);
  background: var(--color-crisis-urgent);
  color: white;
  padding: var(--space-3) var(--space-4);
  border-radius: var(--radius-full);
  font-weight: var(--font-bold);
  z-index: var(--z-crisis);
  box-shadow: var(--shadow-lg);
  min-height: 48px;
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.crisis-hotline:focus-visible {
  outline: 3px solid white;
  outline-offset: 3px;
}

/* ========================================
   COGNITIVE ACCESSIBILITY
   ======================================== */

/* Clear hierarchy */
h1, h2, h3, h4, h5, h6 {
  margin-top: var(--space-8);
  margin-bottom: var(--space-4);
  line-height: var(--leading-tight);
}

/* Consistent spacing */
p, ul, ol {
  margin-bottom: var(--space-4);
  line-height: var(--leading-relaxed);
}

/* Clear action labels */
button[aria-label],
a[aria-label] {
  position: relative;
}

/* Tooltips for additional context */
[data-tooltip] {
  position: relative;
  cursor: help;
}

[data-tooltip]:hover::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--color-neutral-900);
  color: white;
  padding: var(--space-2) var(--space-3);
  border-radius: var(--radius-md);
  font-size: var(--text-sm);
  white-space: nowrap;
  z-index: var(--z-tooltip);
  margin-bottom: var(--space-1);
}

/* ========================================
   TESTING UTILITIES
   ======================================== */

/* Highlight focus order (dev only) */
.debug-focus-order *:focus {
  outline: 3px solid red !important;
  outline-offset: 3px !important;
}

/* Show touch targets (dev only) */
.debug-touch-targets button,
.debug-touch-targets a,
.debug-touch-targets input {
  outline: 1px dashed blue;
  outline-offset: -1px;
}

/* Contrast checker overlay (dev only) */
.debug-contrast * {
  background: white !important;
  color: black !important;
  border: 1px solid black !important;
}